
备份binlog
http://dev.mysql.com/doc/refman/5.6/en/mysqlbinlog-backup.html


------------------------------------------------------------------------------------------------------
灾备：
基于主键合并mysql binlog的event（牺牲了slave实时一致性的同步回访，因为是灾备，不提供线上服务，所以最终一致性即可）
同步复制，返回给用户慢，但一旦返回给用户，就最少有两份数据落盘。
异步复制，返回给用户快，但因为是异步的，在某个时序序列里宕机，那么必然有数据丢失。
半同步复制，如果是收到slave的ack，master在commit返回给用户，那么数据无丢失。如果先commit返回给用户，后接受ack就会丢数据。

--------------------------------------------------------------------------------------------------------------------
xtrabackup备份：

backup，备份阶段，追踪事务日志和复制数据文件（物理备份）。
preparing，重放事务日志，使所有的数据处于同一个时间点，达到一致性状态。

安装：
wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.3/binary/redhat/6/x86_64/percona-xtrabackup-24-2.4.3-1.el6.x86_64.rpm
yum -y install perl perl-devel libaio libaio-devel perl-Time-HiRes perl-DBD-MySQL
rpm -ivh percona-xtrabackup-24-2.4.3-1.el6.x86_64.rpm
（如果报：
   libev.so.4()(64bit) is needed
 ）
 wget ftp://rpmfind.net/linux/dag/redhat/el6/en/x86_64/dag/RPMS/libev-4.15-1.el6.rf.x86_64.rpm
 rpm -ivh libev-4.15-1.el6.rf.x86_64.rpm
 rpm -ivh percona-xtrabackup-24-2.4.3-1.el6.x86_64.rpm    
--------------------------------------------------------------------------------------------------------------------------------
使用：
参数选项列表：https://www.percona.com/doc/percona-xtrabackup/2.4/innobackupex/innobackupex_option_reference.html

1，备份
第一步：copy数据阶段
innobackupex --defaults-file=/etc/my.cnf（必须放在第一个，将读取当前运行这个命令的机器的/etc/my.cnf而不是远程机器的/etc/my.cnf）  
             --user=root --password=kingshard --host=xxx --databases=xtra_test（要备份的库）  /root/xtrabackup/（备份到目标目录）
上一行命令执行完后，会在/root/xtrabackup/目录下生成，2016-06-28_16-39-09目录，目录包含：
backup-my.cnf  ibdata1  xtrabackup_binlog_info  xtrabackup_checkpoints  xtrabackup_info  xtrabackup_logfile

第二步：重放事务日志
innobackupex --apply-log /root/xtrabackup/2016-06-28_16-39-09
重放后目录/root/xtrabackup/2016-06-28_16-39-09包含：
backup-my.cnf  ibdata1  ib_logfile0  ib_logfile1  ibtmp1  xtrabackup_binlog_info  xtrabackup_checkpoints  xtrabackup_info  xtrabackup_logfile
多出了，ib_logfile0  ib_logfile1  ibtmp1 这三个文件

2，还原

------------------------------------------------------------------------------------------------------------------------------------
